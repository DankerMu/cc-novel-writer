# DR-013: API 成本估算

## Executive Summary

单部 5 万字（约 20 章）小说的 API 成本估算为 **$15-30**（使用 Claude Opus 4.6），**$3-6**（使用 Claude Sonnet 4.6）。推荐混合策略：创意密集任务用 Opus，批量生成用 Sonnet。

## Research Question

1. 各阶段 token 消耗量是多少？
2. 基于 Claude API 定价，总成本是多少？
3. 是否存在成本优化空间？

## Methodology

基于 DR-001（context window 分析）和 DR-004（生成速度基准）的数据，计算各创作阶段的 token 消耗，结合 Claude API 定价估算。

## Key Findings

### 1. Claude API 定价（截至 2026 年初）

| 模型 | 输入 ($/1M tokens) | 输出 ($/1M tokens) |
|------|-------------------|-------------------|
| Claude Opus 4.6 | $15 | $75 |
| Claude Sonnet 4.6 | $3 | $15 |
| Claude Haiku 4.5 | $0.80 | $4 |

### 2. 各阶段 Token 消耗估算

**Phase 1: 创意孵化**
- 输入：~2K tokens（用户创意 + 提示词）
- 输出：~3K tokens（project-brief.md）
- 轮次：2-3 次交互
- 小计：输入 6K + 输出 9K

**Phase 2: 世界观构建**
- 输入：~5K tokens（提示词 + 上下文）
- 输出：~8K tokens（geography.md + history.md + rules.md）
- 轮次：3-5 次
- 小计：输入 25K + 输出 40K

**Phase 3: 角色网络**
- 输入：~8K tokens（世界观 + 提示词）
- 输出：~6K tokens（角色档案 × 5-8 个）
- 轮次：5-8 次
- 小计：输入 64K + 输出 48K

**Phase 4: 情节架构**
- 输入：~10K tokens（世界观 + 角色 + 提示词）
- 输出：~5K tokens（大纲 + foreshadowing）
- 轮次：3-5 次
- 小计：输入 50K + 输出 25K

**Phase 5: 章节写作（20 章）**
- 每章输入：~12K tokens（世界观 5K + 角色 3K + 大纲 2K + 状态 2K）
- 每章输出：~4.5K tokens（3000 字中文）
- 20 章小计：输入 240K + 输出 90K

**Phase 6: 迭代优化**
- 一致性检查：输入 50K + 输出 5K
- 重写 3-5 章：输入 60K + 输出 22K
- 小计：输入 110K + 输出 27K

### 3. 总成本估算

**Token 总消耗**：
- 总输入：~495K tokens
- 总输出：~239K tokens

**按模型计价**：

| 模型 | 输入成本 | 输出成本 | 总成本 |
|------|---------|---------|--------|
| Opus 4.6 | $7.43 | $17.93 | **$25.36** |
| Sonnet 4.6 | $1.49 | $3.59 | **$5.08** |
| Haiku 4.5 | $0.40 | $0.96 | **$1.36** |

### 4. 混合策略（推荐）

| 阶段 | 推荐模型 | 原因 |
|------|---------|------|
| Phase 1-2 | Opus | 创意质量关键 |
| Phase 3-4 | Opus | 角色/情节需要高质量推理 |
| Phase 5 | Sonnet | 批量写作，成本敏感 |
| Phase 6 | Sonnet + Opus | 检查用 Sonnet，重写用 Opus |

**混合策略预估成本**：
- Phase 1-4（Opus）：输入 145K × $15/M + 输出 122K × $75/M = $2.18 + $9.15 = **$11.33**
- Phase 5（Sonnet）：输入 240K × $3/M + 输出 90K × $15/M = $0.72 + $1.35 = **$2.07**
- Phase 6（混合）：~**$2.50**
- **总计：~$15.90**

### 5. 规模化成本

| 规模 | 章数 | 字数 | Opus 全用 | 混合策略 |
|------|------|------|-----------|----------|
| 短篇 | 5 章 | 1.5 万字 | ~$10 | ~$6 |
| 中篇 | 20 章 | 5 万字 | ~$25 | ~$16 |
| 长篇 | 50 章 | 15 万字 | ~$55 | ~$35 |
| 超长篇 | 100 章 | 30 万字 | ~$100 | ~$65 |

## Sources

- Anthropic API 定价页（2025-2026）
- DR-001: Context Window 分析
- DR-004: 生成速度基准

## Conclusion

**决策建议**：
1. 单部 5 万字小说成本 $16-25，在可接受范围内
2. 推荐混合策略（创意阶段 Opus + 批量写作 Sonnet），可节省 37%
3. 章节写作是最大成本项（占 60%+），应优先优化
4. 在 Milestone 1 实测验证成本估算准确性
